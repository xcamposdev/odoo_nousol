<odoo>
	<data>
		<template id="report_picking_custom" inherit_id="stock.report_picking">
		
			<xpath expr="//div[@class='page']" position="replace">
				<div class="page">
					<div class="row">
						<div class="col-6">
							<div t-if="o.move_ids_without_package and o.move_ids_without_package[0].partner_id and o.move_ids_without_package[0].partner_id.id != o.partner_id.id">
								<span><strong>Dirección entrega:</strong></span>
								<div t-field="o.move_ids_without_package[0].partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
							</div>
							<div t-if="o.picking_type_id.code != 'internal' and (not o.move_ids_without_package or not o.move_ids_without_package[0].partner_id) and o.picking_type_id.warehouse_id.partner_id">
								<span><strong>Dirección almacen:</strong></span>
								<div t-field="o.picking_type_id.warehouse_id.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
							</div>
						</div>
						<div class="col-5 offset-1">
							<div t-if="o.picking_type_id.code=='incoming' and o.partner_id">
								<span><strong>Dirección:</strong></span>
							</div>
							<div t-if="o.picking_type_id.code=='internal' and o.partner_id">
								<span><strong>Dirección almacen:</strong></span>
							</div>
							<div t-if="o.picking_type_id.code=='outgoing' and o.partner_id">
								<span><strong>Dirección entrega:</strong></span>
							</div>
							<div t-if="o.partner_id" name="partner_header">
								<div t-field="o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
								<p t-if="o.sudo().partner_id.vat"><t t-esc="o.company_id.country_id.vat_label or 'Tax ID'"/>: <span t-field="o.sudo().partner_id.vat"/></p>
							</div>
						</div>
					</div>
					<br/>
                    <h1>
                        <span>Albarán: </span>
                    </h1>
					<h1 t-field="o.name" class="mt0 float-left"/>
					<div class="row mt48 mb32">
						<div t-if="o.origin" class="col-auto">
							<strong>Referencia pedido:</strong>
							<p t-field="o.origin"/>
						</div>
						<div class="col-auto" name="div_sched_date">
							<strong>Fecha prevista de entrega:</strong>
							<p t-field="o.scheduled_date" t-options='{"format": "dd/MM/yyyy"}'/>
						</div>
					</div>
					<table class="table table-sm" t-if="o.move_line_ids and o.move_ids_without_package">
						<t t-set="has_barcode" t-value="any([move_ids_without_package.product_id and move_ids_without_package.product_id.sudo().barcode or move_ids_without_package.package_id for move_ids_without_package in o.move_line_ids])"/>
						<t t-set="has_serial_number" t-value="o.move_line_ids.filtered(lambda ml: ml.lot_id or ml.lot_name)" groups="stock.group_production_lot"/>
						<thead>
							<tr>
								<th>
									<strong>Producto</strong>
								</th>
								<th>
									<strong>Cantidad</strong>
								</th>
							</tr>
						</thead>
						<tbody>
							<t t-foreach="o.move_ids_without_package.sorted(key=lambda m: m.product_id.id)" t-as="move">
								<!-- In case you come accross duplicated lines, ask NIM or LAP -->
								<t t-foreach="move.move_line_ids.sorted(key=lambda ml: ml.location_id.id)" t-as="ml">
									<tr>
										<td>
											<span t-field="ml.product_id.name"/>
										</td>
										<td>
											<span t-if="o.state != 'done'" t-field="ml.product_uom_qty"/>
											<span t-if="o.state == 'done'" t-field="ml.qty_done"/>
											<span t-field="ml.product_uom_id" groups="uom.group_uom"/>

										</td>
									</tr>
								</t>
							</t>
						  </tbody>
					</table>
					<!--<table class="table table-sm" t-if="o.package_level_ids and o.picking_type_entire_packs and o.state in ['assigned', 'done']">
						<thead>
							<tr>
								<th>Package</th>
								<th t-if="o.picking_type_id.code != 'incoming'" groups="stock.group_stock_multi_locations">From</th>
								<th t-if="o.picking_type_id.code != 'outgoing'" groups="stock.group_stock_multi_locations">To</th>
							</tr>
						</thead>
						<tbody>
							<tr t-foreach="o.package_level_ids.sorted(key=lambda p: p.package_id.name)" t-as="package">
								<t t-set="package" t-value="package.with_context(picking_id=o.id)"/>
								<td>
									<img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;humanreadable=1' % ('Code128', package.package_id.name, 600, 100)" style="width:300px;height:50px; margin-left: -50px;" alt="Barcode"/><br/>
								</td>
								<td t-if="o.picking_type_id.code != 'incoming'" groups="stock.group_stock_multi_locations">
									<span t-field="package.location_id"/>
								</td>
								<td t-if="o.picking_type_id.code != 'outgoing'" groups="stock.group_stock_multi_locations">
									<span t-field="package.location_dest_id"/>
								</td>
							</tr>
						</tbody>
					</table>-->
					<t t-set="no_reserved_product" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty != x.reserved_availability and x.move_line_ids and x.state!='done')"/>
					<p t-if="o.state in ['draft', 'waiting', 'confirmed'] or no_reserved_product"><i class="fa fa-exclamation-triangle"/>
						All products could not be reserved. Click on the "Check Availability" button to try to reserve products.
					</p>
					<p t-field="o.note"/>
				</div>
			</xpath>
			
		</template>		
    </data>
</odoo>
    